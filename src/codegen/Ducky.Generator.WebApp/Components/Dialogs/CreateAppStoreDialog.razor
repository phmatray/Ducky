@using Ducky.Generator.WebApp.Services
@inject IAppStoreService AppStoreService
@inject ISnackbar Snackbar

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Filled.Add" Class="mr-2" Style="vertical-align: middle;" />
            Create New App Store
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudStack Spacing="4">
            <MudAlert Severity="Severity.Info" Variant="Variant.Outlined" Dense="true">
                <MudText Typo="Typo.body2">
                    An app store is a container for your application's state management logic. 
                    Choose a template to get started quickly, or create a custom store from scratch.
                </MudText>
            </MudAlert>

            <!-- Quick Start Templates -->
            <MudExpansionPanels Elevation="0" Class="mb-4">
                <MudExpansionPanel Text="ðŸš€ Quick Start Templates">
                    <MudText Typo="Typo.body2" Class="mb-3">Choose a template that matches your use case:</MudText>
                    <MudGrid Spacing="2">
                        <MudItem xs="12" sm="6" md="3">
                            <MudPaper Class="pa-3 text-center mud-hover-card" 
                                      Style="cursor: pointer; transition: all 0.2s; border: 2px solid transparent;"
                                      @onclick="() => SelectTemplate(AppStoreTemplate.TodoApp)">
                                <MudIcon Icon="@Icons.Material.Filled.ListAlt" Size="Size.Large" Color="Color.Primary" />
                                <MudText Typo="Typo.subtitle2">Todo App</MudText>
                                <MudText Typo="Typo.caption" Color="Color.Secondary">Task management</MudText>
                            </MudPaper>
                        </MudItem>
                        <MudItem xs="12" sm="6" md="3">
                            <MudPaper Class="pa-3 text-center mud-hover-card" 
                                      Style="cursor: pointer; transition: all 0.2s; border: 2px solid transparent;"
                                      @onclick="() => SelectTemplate(AppStoreTemplate.ECommerce)">
                                <MudIcon Icon="@Icons.Material.Filled.ShoppingCart" Size="Size.Large" Color="Color.Success" />
                                <MudText Typo="Typo.subtitle2">E-Commerce</MudText>
                                <MudText Typo="Typo.caption" Color="Color.Secondary">Products & cart</MudText>
                            </MudPaper>
                        </MudItem>
                        <MudItem xs="12" sm="6" md="3">
                            <MudPaper Class="pa-3 text-center mud-hover-card" 
                                      Style="cursor: pointer; transition: all 0.2s; border: 2px solid transparent;"
                                      @onclick="() => SelectTemplate(AppStoreTemplate.Dashboard)">
                                <MudIcon Icon="@Icons.Material.Filled.Dashboard" Size="Size.Large" Color="Color.Warning" />
                                <MudText Typo="Typo.subtitle2">Dashboard</MudText>
                                <MudText Typo="Typo.caption" Color="Color.Secondary">Analytics & metrics</MudText>
                            </MudPaper>
                        </MudItem>
                        <MudItem xs="12" sm="6" md="3">
                            <MudPaper Class="pa-3 text-center mud-hover-card" 
                                      Style="cursor: pointer; transition: all 0.2s; border: 2px solid transparent;"
                                      @onclick="() => SelectTemplate(AppStoreTemplate.Custom)">
                                <MudIcon Icon="@Icons.Material.Filled.Create" Size="Size.Large" Color="Color.Default" />
                                <MudText Typo="Typo.subtitle2">Custom</MudText>
                                <MudText Typo="Typo.caption" Color="Color.Secondary">Start from scratch</MudText>
                            </MudPaper>
                        </MudItem>
                    </MudGrid>
                    
                    @if (_selectedTemplate != AppStoreTemplate.Custom)
                    {
                        <MudAlert Severity="Severity.Success" Class="mt-3" Dense="true">
                            <MudText Typo="Typo.body2">
                                Selected template: <strong>@GetTemplateName(_selectedTemplate)</strong><br/>
                                @GetTemplateDescription(_selectedTemplate)
                            </MudText>
                        </MudAlert>
                    }
                </MudExpansionPanel>
            </MudExpansionPanels>
            
            <MudForm @ref="_form" @bind-IsValid="@_isValid">
                <MudStack Spacing="3">
                    <MudTextField @bind-Value="_appStoreName" 
                                  Label="App Store Name" 
                                  Required="true"
                                  RequiredError="App store name is required"
                                  Variant="Variant.Outlined"
                                  Adornment="Adornment.Start"
                                  AdornmentIcon="@Icons.Material.Filled.Store"
                                  HelperText="A descriptive name for your app store"
                                  Counter="100"
                                  MaxLength="100"
                                  Immediate="true"
                                  OnlyValidateIfDirty="false"
                                  TextChanged="OnAppStoreNameChanged" />
                    
                    <MudTextField @bind-Value="_description" 
                                  Label="Description (Optional)" 
                                  Lines="3"
                                  Variant="Variant.Outlined"
                                  Adornment="Adornment.Start"
                                  AdornmentIcon="@Icons.Material.Filled.Description"
                                  HelperText="Briefly describe what this app store manages"
                                  Counter="500"
                                  MaxLength="500" />
                    
                    <MudTextField @bind-Value="_namespaceName" 
                                  Label="C# Namespace" 
                                  Required="true"
                                  RequiredError="Namespace is required"
                                  Variant="Variant.Outlined"
                                  Adornment="Adornment.Start"
                                  AdornmentIcon="@Icons.Material.Filled.FolderOpen"
                                  HelperText="The C# namespace for generated code"
                                  Counter="100"
                                  MaxLength="100"
                                  Validation="@(new Func<string, string?>(ValidateNamespace))" />
                    
                    <!-- Namespace Preview -->
                    @if (!string.IsNullOrWhiteSpace(_namespaceName) && !string.IsNullOrWhiteSpace(_appStoreName))
                    {
                        <MudPaper Class="pa-3" Elevation="0" Style="background-color: #f5f5f5;">
                            <MudText Typo="Typo.caption" Color="Color.Secondary">Preview:</MudText>
                            <MudText Typo="Typo.body2" Style="font-family: 'Cascadia Code', monospace;">
                                namespace @_namespaceName { ... }
                            </MudText>
                        </MudPaper>
                    }
                </MudStack>
            </MudForm>
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel" Variant="Variant.Text">Cancel</MudButton>
        <MudButton Color="Color.Primary" 
                   Variant="Variant.Filled" 
                   OnClick="SubmitAsync"
                   StartIcon="@Icons.Material.Filled.Check"
                   Disabled="@(!_isValid || _isCreating)">
            @if (_isCreating)
            {
                <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-2" />
                <span>Creating...</span>
            }
            else
            {
                <span>Create App Store</span>
            }
        </MudButton>
    </DialogActions>
</MudDialog>

<style>
    .mud-hover-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.15) !important;
        border-color: #1976d2 !important;
    }
</style>