@inject IJSRuntime Js
@inject ISnackbar Snackbar

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Filled.Code" Class="mr-2" Style="vertical-align: middle;" />
            Generated Code - @AppStoreName
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudStack Spacing="3">
            <!-- Summary Section -->
            <MudPaper Class="pa-4" Elevation="0" Style="background-color: #e8f5e9;">
                <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                    <div>
                        <MudText Typo="Typo.body1">
                            <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Color="Color.Success" Class="mr-2" />
                            Successfully generated @GeneratedFiles.Count files
                        </MudText>
                        <MudText Typo="Typo.caption" Color="Color.Secondary">
                            Your Ducky state management code is ready to use!
                        </MudText>
                    </div>
                    <MudStack Row="true" Spacing="2">
                        <MudButton Variant="Variant.Filled" 
                                   Color="Color.Primary"
                                   StartIcon="@Icons.Material.Filled.Download"
                                   OnClick="DownloadAllAsync">
                            Download All
                        </MudButton>
                        <MudButton Variant="Variant.Outlined" 
                                   Color="Color.Primary"
                                   StartIcon="@Icons.Material.Filled.ContentCopy"
                                   OnClick="CopyAllToClipboardAsync">
                            Copy All
                        </MudButton>
                    </MudStack>
                </MudStack>
            </MudPaper>

            <!-- File Tabs -->
            <MudTabs Elevation="0" Rounded="true" Centered="false" Color="Color.Primary" 
                     PanelClass="pa-0" HeaderPosition="TabHeaderPosition.Before"
                     Style="min-height: 500px;">
                @foreach (var fileGroup in GeneratedFiles.GroupBy(f => f.FileType).OrderBy(g => GetFileTypeOrder(g.Key)))
                {
                    <MudTabPanel Text="@GetFileTypeDisplay(fileGroup.Key)" 
                                 Icon="@GetFileTypeIcon(fileGroup.Key)"
                                 BadgeData="@fileGroup.Count()"
                                 BadgeColor="Color.Info">
                        <MudStack Spacing="3">
                            @foreach (var file in fileGroup.OrderBy(f => f.FileName))
                            {
                                <MudExpansionPanels Elevation="1">
                                    <MudExpansionPanel>
                                        <TitleContent>
                                            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween" Style="width: 100%;">
                                                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                                                    <MudIcon Icon="@GetFileIcon(file.FileName)" Size="Size.Small" />
                                                    <MudText Typo="Typo.body1">@file.FileName</MudText>
                                                    <MudChip T="string" Size="Size.Small" Color="GetFileTypeColor(file.FileType)">
                                                        @file.FileType
                                                    </MudChip>
                                                </MudStack>
                                                <MudStack Row="true" Spacing="1" @onclick:stopPropagation="true">
                                                    <MudTooltip Text="Copy to clipboard">
                                                        <MudIconButton Icon="@Icons.Material.Filled.ContentCopy" 
                                                                       Size="Size.Small"
                                                                       OnClick="@(() => CopyToClipboardAsync(file.Content, file.FileName))" />
                                                    </MudTooltip>
                                                    <MudTooltip Text="Download file">
                                                        <MudIconButton Icon="@Icons.Material.Filled.Download" 
                                                                       Size="Size.Small"
                                                                       OnClick="@(() => DownloadFileAsync(file))" />
                                                    </MudTooltip>
                                                </MudStack>
                                            </MudStack>
                                        </TitleContent>
                                        <ChildContent>
                                            <MudPaper Class="pa-3" 
                                                      Style="background-color: #1e1e1e; border-radius: 8px; max-height: 600px; overflow: auto;">
                                                <pre style="margin: 0; color: #d4d4d4; font-family: 'Cascadia Code', 'Courier New', monospace; font-size: 13px; line-height: 1.5;">@file.Content</pre>
                                            </MudPaper>
                                        </ChildContent>
                                    </MudExpansionPanel>
                                </MudExpansionPanels>
                            }
                        </MudStack>
                    </MudTabPanel>
                }
            </MudTabs>
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Close">Close</MudButton>
    </DialogActions>
</MudDialog>